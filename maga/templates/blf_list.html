{% extends 'base.html' %}


{% block content %}
<script type="application/javascript">
    
    $(document).ready(function() {
        globalUrl = $('#ip_address').val()
        
        getListByPage(page = 1)

        function getEtat(status) {
            etat = ''
            switch(parseInt(status)){
                case 1:
                    etat = 'Début ramassage'
                break;
                case 2:
                    etat = 'Fin ramassage'
                break;
                case 3:
                    etat = 'Début emballage'
                break;
                case 4:
                    etat = 'Fin emballage'
                break;

                case 5:
                    etat = 'Prépa expédition'
                break;

                case 6:
                    etat = 'Expédition'
                break;
            }
            return etat
        }

        function getListByPage(page = 1) {
            
            $('#pagination').pagination({
                dataSource: globalUrl+'/api/blflist/'+ page,
                locator: 'items',
                totalNumberLocator: function(response) {
                    // you can return totalNumber by analyzing response content
                    console.log(response)
                    return Math.floor(Math.random() * (1000 - 100)) + 100;
                },
                pageSize: 10,
                ajax: {
                    beforeSend: function() {
                        console.log('Loading data from flickr.com ...')
                        // dataContainer.html('Loading data from flickr.com ...');
                    }
                },
                callback: function(data, pagination) {
                    // template method of yourself
                    console.log(data)
                    //dataContainer.html(html);
                }
            })

            $.ajax({
                method : 'GET'
                ,url : globalUrl+'/api/blflist/'+ page
                ,dataType: 'JSON'
                , success : function(blflist) {
                    console.log(blflist)
                    for (var i = 0; i < blflist['items'].length; i++) {
                        id      = blflist['items'][i].id
                        numblf  = blflist['items'][i].NumBlf
                        client  = blflist['items'][i].client
                        date_saisie =  blflist['items'][i].date_saisie
                        nblg    = blflist['items'][i].nblg
                        adv     = blflist['items'][i].saisie
                        statut = blflist['items'][i].statut
                        province = blflist['items'][i].province
                        district = blflist['items'][i].district
                        //console.log(blflist['data'][i])
                        $('#blf-list').append("<tr>"
                            + "<td>" + id + "</td>"
                            + "<td>" + numblf + "</td>"
                            + "<td>" + nblg + "</td>"
                            + "<td>" + client + "</td>"
                            + "<td>" + date_saisie + "</td>"
                            + "<td>" + adv + "</td>"
                            + "<td>" + getEtat(statut) + "</td>"
                            + "<td>" + province +' '+ district + "</td>"
                            
                            + "</tr>")
                    }
                    //$('#pagination').append('<ul></ul>')
                    //for (var i =0; i < blflist['pagination']['max']; i++) {
                        //$('#pagination').find('ul').append('<li>'+i+'</li>')
                    //}
                }
            });
        }

        

    })

</script>

<section id="services" class="services section-bg">
    <input id="ip_address" type="hidden" name="ip_address" value="{{ ip_address }}">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Page pour la géstions des bon de livraison et facturation! </h1>
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>N°BLF</th>
                            <th>NB Lg</th>
                            <th>Client</th>
                            <th>Date de saisie</th>
                            <th>ADV</th>
                            <th>Etat</th>
                            <th>PROVINCE/DISTRICT</th>
                        </tr>
                    </thead>
                    <tbody id="blf-list"></tbody>
                </table>
                <div id="pagination"></div>
            </div>
        </div>
    </div>
</section>


{% endblock %}